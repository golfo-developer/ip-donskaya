<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/@vkid/sdk@<3.0.0/dist-sdk/umd/index.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="loginScreen" class="screen">
        <div class="login-container">
            <div class="login-card">
                <h1>üöó –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º</h1>
                <p class="subtitle">–í–æ–π–¥–∏—Ç–µ —Å –ø–æ–º–æ—â—å—é VK ID</p>
                <div id="vk-auth-container"></div>
            </div>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="appScreen" class="screen hidden">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="app-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="burger-menu" id="burgerMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <h1 class="app-title">üöó –ê–≤—Ç–æ–ø–∞—Ä–∫</h1>
            </div>
            <div class="user-info">
                <span class="user-name" id="userName"></span>
                <span class="user-role" id="userRole"></span>
                <button onclick="logout()" class="btn-logout">–í—ã—Ö–æ–¥</button>
            </div>
        </header>
        
        <!-- Overlay –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
        <div class="nav-overlay" id="navOverlay"></div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav-tabs" id="mainNav">
            <button class="nav-btn active" data-tab="cars">–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</button>
            <button class="nav-btn" data-tab="mycars">–ú–æ–∏ –∞–≤—Ç–æ</button>
            <button class="nav-btn" data-tab="users" style="display:none;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="nav-btn" data-tab="maintenance" style="display:none;">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</button>
            <button class="nav-btn" data-tab="statistics" style="display:none;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="nav-btn" data-tab="verification" style="display:none;">–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
        </nav>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <main>
            <!-- –í–∫–ª–∞–¥–∫–∞: –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ -->
            <div id="carsTab" class="tab-content active">
                <div class="tab-header">
                    <h2>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</h2>
                    <button id="addCarBtn" class="btn-primary" style="display:none;">+ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</button>
                </div>

                <div class="filter-buttons">
                    <button class="filter-btn active" data-garage="all">–í—Å–µ</button>
                    <button class="filter-btn" data-garage="general">–û–±—â–∏–π –≥–∞—Ä–∞–∂</button>
                    <button class="filter-btn" data-garage="tk">–¢–ö</button>
                    <button class="filter-btn" data-garage="atp">–ê–¢–ü</button>
                </div>

                <div id="carsList" class="cards-grid"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <!-- –í–∫–ª–∞–¥–∫–∞: –ú–æ–∏ –∞–≤—Ç–æ -->
            <div id="mycarsTab" class="tab-content">
                <div class="tab-header">
                    <h2>–ú–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h2>
                </div>
                <div id="myCarsList"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div id="usersTab" class="tab-content">
                <div class="tab-header">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                </div>
                <div id="usersList"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ -->
            <div id="maintenanceTab" class="tab-content">
                <div class="tab-header">
                    <h2>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h2>
                </div>
                
                <div class="sub-tabs">
                    <button class="sub-tab-btn active" data-subtab="service">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</button>
                    <button class="sub-tab-btn" data-subtab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
                </div>

                <div id="serviceSubtab" class="subtab-content active">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-garage-m="all">–í—Å–µ –≥–∞—Ä–∞–∂–∏</button>
                        <button class="filter-btn" data-garage-m="general">–û–±—â–∏–π –≥–∞—Ä–∞–∂</button>
                        <button class="filter-btn" data-garage-m="tk">–¢–ö</button>
                        <button class="filter-btn" data-garage-m="atp">–ê–¢–ü</button>
                    </div>
                    <div id="maintenanceCarsList" class="cards-grid"></div>
                </div>

                <div id="historySubtab" class="subtab-content">
                    <div id="maintenanceHistory"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="statisticsTab" class="tab-content">
                <div class="tab-header">
                    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h2>
                </div>
                <div id="statisticsContent"></div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ -->
            <div id="verificationTab" class="tab-content">
                <div class="tab-header">
                    <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∫–æ–≤–∫–∏</h2>
                </div>
                <div id="verificationContent"></div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modalOverlay" class="modal-overlay hidden"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å -->
    <div id="addCarModal" class="modal hidden">
        <div class="modal-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
            <form id="addCarForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
                    <input type="text" name="license_plate" required>
                </div>
                <div class="form-group">
                    <label>–¶–≤–µ—Ç</label>
                    <input type="text" name="color" required>
                </div>
                <div class="form-group">
                    <label>–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                    <input type="number" name="state_cost" required>
                </div>
                <div class="form-group">
                    <label>–§–æ—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</label>
                    <input type="file" name="photo" accept="image/*" id="carPhotoInput">
                    <small>–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ (Ctrl+V)</small>
                    <div id="photoPreview" style="margin-top: 10px; display: none;">
                        <img id="photoPreviewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                    </div>
                </div>
                <div class="form-group">
                    <label>–ì–∞—Ä–∞–∂</label>
                    <select name="garage_type">
                        <option value="general">–û–±—â–∏–π –≥–∞—Ä–∞–∂</option>
                        <option value="tk">–¢–ö</option>
                        <option value="atp">–ê–¢–ü</option>
                    </select>
                </div>
                <div class="form-group" id="locationGroup">
                    <label>–ú–µ—Å—Ç–æ</label>
                    <input type="text" name="location">
                </div>
                <div class="form-group">
                    <label>–°—Ç–µ–π–¥–∂–∏</label>
                    <input type="text" name="stages">
                </div>
                <div class="form-group">
                    <label>–£—Ä–æ–≤–µ–Ω—å —Ç–æ–ø–ª–∏–≤–∞ (–ª)</label>
                    <input type="number" step="0.1" name="fuel" value="0">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addCarModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í–∑—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å -->
    <div id="takeCarModal" class="modal hidden">
        <div class="modal-content">
            <h3>–í–∑—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
            <div id="takeCarInfo"></div>
            <form id="takeCarForm">
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="was_damaged">
                        –ê–≤—Ç–æ–º–æ–±–∏–ª—å –±—ã–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('takeCarModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í–µ—Ä–Ω—É—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å -->
    <div id="returnCarModal" class="modal hidden">
        <div class="modal-content">
            <h3>–í–µ—Ä–Ω—É—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
            <div id="returnCarInfo"></div>
            <form id="returnCarForm">
                <div class="form-group">
                    <label>–£—Ä–æ–≤–µ–Ω—å —Ç–æ–ø–ª–∏–≤–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ (–ª)</label>
                    <input type="number" step="0.1" name="fuel_returned" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">–í–µ—Ä–Ω—É—Ç—å</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('returnCarModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="editUserModal" class="modal hidden">
        <div class="modal-content">
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <div id="editUserInfo"></div>
            <form id="editUserForm">
                <div class="form-group">
                    <label>–†–æ–ª—å</label>
                    <select name="role" required>
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="junior_staff">–ú–ª–∞–¥—à–∏–π —Å–æ—Å—Ç–∞–≤</option>
                        <option value="senior_staff">–°—Ç–∞—Ä—à–∏–π —Å–æ—Å—Ç–∞–≤</option>
                        <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                        <option value="senior_manager">–°—Ç–∞—Ä—à–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä</option>
                        <option value="deputy_director">–ó–∞–º. –î–∏—Ä–µ–∫—Ç–æ—Ä–∞</option>
                        <option value="director">–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
                    </select>
                </div>
                <div class="form-group" id="customPositionGroup" style="display:none;">
                    <label>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" name="custom_position" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä">
                    <small>–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏</small>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('editUserModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ -->
    <div id="maintenanceModal" class="modal hidden">
        <div class="modal-content">
            <h3>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h3>
            <div id="maintenanceCarInfo"></div>
            <form id="maintenanceForm">
                <div class="form-group">
                    <label>–î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–æ–ø–ª–∏–≤–∞ (–ª)</label>
                    <input type="number" step="0.1" name="fuel_added" value="0">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="was_damaged" id="wasDamagedCheck">
                        –ê–≤—Ç–æ–º–æ–±–∏–ª—å –±—ã–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
                    </label>
                </div>
                <div class="form-group" id="repairGroup" style="display:none;">
                    <label class="checkbox-label">
                        <input type="checkbox" name="repaired" id="repairedCheck">
                        –ê–≤—Ç–æ–º–æ–±–∏–ª—å –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
                    </label>
                </div>
                <div class="form-group" id="repairCostGroup" style="display:none;">
                    <label>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞ (‚ÇΩ)</label>
                    <input type="number" name="repair_cost" value="0">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">–û–±—Å–ª—É–∂–∏—Ç—å</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('maintenanceModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>